# docker-dev-server-kit
Docker starter kit and scripts for full dev environment. Nginx, php, databases and additional envs in docker containers for each project on your corporate dev server 

### Правила работы дев сервера:
Основанием служит palchik1985/docker-php-starter-kit. Однако в случае полноценной изоляции каждого проекта, docker контейнеры будут занимать ~ 1Gb на каждый проект. Необходима экономия места, при той же эффективности разворачивания новых проектов.

## Требования
- Установка софта на сервер должна быть сведена к минимуму, всё работает на основании docker контейнеров, для легкого деплоя и переноса между серверами
- Контейнеры, которые требуются почти на всех проектах или занимают много места (PHP сборка ~500Mb, MySql ~380Mb), должны быть единственными на сервере, остальные проекты подключаются к ним. Nginx также один главный.
- MySql и postgres контейнеры - по 1 на сервер. Каждый проект подключается к своей бд со своим юзером. В бд чужого проекта MySQL юзер смотреть не может.
- SSH ключи и доступ к серверу должны менеджиться админ персоналом, а не девопсами. Желательно через панель управления
- У каждого проекта есть стандартный набор папок в которых хранятся инструменты для деплоя. Каждый проект имеет локальный docker конфиг и dev docker конфиг.
- Nginx забирает конфиги из папок каждого проекта, которые имеют одинаковое название - project_root/deploy/sitename.conf
- Реализовано автоматическое обновление проектов по webhook в bitbucket (после обновления ветки, идет автообновление проекта на сервере). Ветка master обновляется на dev сервере. Prod сервер обновляется с ветки prod
- В ветку prod пушит только тимлид проекта, либо на основании пул-реквестов
- В файле project_root/deploy/build.sh добавляются любые команды, необходимые для сборки проекта на сервере.
- Сервер имеет систему мониторинга, на основе 
https://code-maze.com/top-docker-monitoring-tools/
https://rancher.com/comparing-monitoring-options-for-docker-deployments/
- Проекты сервера по возможности отделены друг от друга, на основании chroot или docker container (https://github.com/yelp/dockersh/)
- Рестарт сервисов (PHP, nginx etc) осуществляется не напрямую а через скрипты с правами --x--x--x (никто не может читать и писать, все могут выполнять)

#### фичи на будущее, о которых необходимо подумать:
- 3-4 предыдущих версии деплоя хранится на сервере для легкой возможности быстро откатить код назад
- проброс пользователя в конкретный docker контейнер при подключении, без возможности получить доступ к остальной системе
